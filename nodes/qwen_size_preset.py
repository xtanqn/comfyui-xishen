"""
🍡Qwen-尺寸预设节点

该节点提供多种预设尺寸选项，用于生成不同比例和分辨率的latent图像。
支持1:1、3:4、4:3、9:16、16:9等多种常用比例，并可设置批量张数和是否对齐到8的倍数。

输出：
- latent：根据所选尺寸生成的潜在空间图像
"""

import torch

class Qwen_尺寸预设:
    """
    尺寸预设节点类
    
    该类定义了一个ComfyUI节点，用于生成各种预设尺寸的latent图像。
    支持多种常用比例和分辨率，可设置批量张数和对齐选项。
    """
    
    # 节点分类，按照项目规则设置
    CATEGORY = "🍡Comfyui-xishen"
    
    # 预设尺寸映射，包含各种比例和对应的分辨率
    预设尺寸映射 = {
        "1:1 - 512 x 512": (512, 512),
        "1:1 - 768 x 768": (768, 768),
        "1:1 - 1024 x 1024": (1024, 1024),
        "1:1 - 1328 x 1328": (1328, 1328),
        "2:3 - 768 x 1152": (768, 1152),
        "2:3 - 960 x 1440": (960, 1440),
        "3:2 - 1152 x 768": (1152, 768),
        "3:2 - 1440 x 960": (1440, 960),
        "3:4 - 896 x 1152": (896, 1152),
        "3:4 - 1140 x 1472": (1140, 1472),
        "4:3 - 1152 x 896": (1152, 896),
        "4:3 - 1472 x 1140": (1472, 1140),
        "9:16 - 768 x 1344": (768, 1344),
        "9:16 - 928 x 1664": (928, 1664),
        "16:9 - 1344 x 768": (1344, 768),
        "16:9 - 1664 x 928": (1664, 928),
    }
    
    @classmethod
    def INPUT_TYPES(s):
        """
        定义节点的输入参数
        
        返回:
            dict: 包含输入参数类型定义的字典
        """
        # 获取所有预设尺寸选项
        尺寸选项 = list(s.预设尺寸映射.keys())
        
        return {
            "required": {
                "尺寸预设": (尺寸选项, {"default": "1:1 - 1328 x 1328"}),
                "批量张数": ("INT", {"default": 1, "min": 1, "max": 100, "step": 1}),
                "对齐到8的倍数": ("BOOLEAN", {"default": True}),
            },
        }
    
    # 定义节点的输出类型
    RETURN_TYPES = ("LATENT",)
    RETURN_NAMES = ("latent",)
    
    # 节点的主要功能函数名称
    FUNCTION = "生成尺寸预设"
    
    def 生成尺寸预设(self, 尺寸预设, 批量张数, 对齐到8的倍数):
        """
        生成尺寸预设的latent图像
        
        参数:
            尺寸预设: 选择的预设尺寸
            批量张数: 生成的图像数量
            对齐到8的倍数: 是否将尺寸对齐到8的倍数
        
        返回:
            tuple: 包含生成的latent图像的元组
        """
        # 获取所选尺寸的宽高
        width, height = self.预设尺寸映射[尺寸预设]
        
        # 如果需要对齐到8的倍数，进行调整
        if 对齐到8的倍数:
            width = (width + 7) // 8 * 8
            height = (height + 7) // 8 * 8
        
        # 创建latent图像
        # 注意：这里我们只生成latent的结构，不需要实际的VAE编码
        latent = {
            "samples": torch.zeros([批量张数, 4, height // 8, width // 8]),
            "batch_size": 批量张数,
            "width": width,
            "height": height
        }
        
        return (latent,)

# 定义节点映射，用于注册到ComfyUI
NODE_CLASS_MAPPINGS = {
    "🍡Qwen-尺寸预设": Qwen_尺寸预设
}

# 定义节点显示名称映射
NODE_DISPLAY_NAME_MAPPINGS = {
    "🍡Qwen-尺寸预设": "🍡Qwen-尺寸预设-xishen"
}