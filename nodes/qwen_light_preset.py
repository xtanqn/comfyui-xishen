"""
打光预设节点

该节点提供各种预设的打光风格选项，用户可以通过选择不同的风格和具体打光类型来生成对应的提示词。

分类:
- 柔和清新/治愈风格
- 戏剧张力/暗黑风格
- 经典肖像/专业棚拍风
- 梦幻奇幻/氛围风格
- 风格化/潮流街头风格

每个风格类别下有多种具体的打光类型可供选择。
"""

class Qwen_打光预设:
    """
    打光预设节点类
    
    该类定义了一个ComfyUI节点，用于生成各种打光风格的提示词。
    支持多种预设风格和具体打光类型的组合。
    """
    
    # 节点分类，按照项目规则设置
    CATEGORY = "🍡Comfyui-xishen"
    
    # 打光风格映射字典，包含每个大类对应的打光类型选项
    打光风格映射 = {
        "柔和清新/治愈风格": [
            "无",
            "亮调布光（适配日系写真、儿童摄影、治愈系人像）",
            "正面光布光（适配证件照、素背景人像）",
            "柔光布光（适配日常人像、婴儿摄影）",
            "柔光箱光效布光（适配室内人像、棚拍、商业人像）",
            "柔光过曝布光（适配日系清新人像、情绪片）",
            "逆光布光（适配通透人像、日落场景）"
        ],
        "戏剧张力/暗黑风格": [
            "无",
            "暗调布光（适配暗黑系人像、夜景科幻场景）",
            "聚光布光（适配情绪人像、人物特写）",
            "顶光布光（适配反派特写、戏剧张力场景）",
            "底光布光（适配恐怖题材、戏剧妆、创意人像）",
            "分割光布光（适配双面人格主题、时尚封面）",
            "硬光过曝布光（适配工业风人像、街头摄影）"
        ],
        "经典肖像/专业棚拍风": [
            "无",
            "伦勃朗光布光（适配复古肖像、油画风创作）",
            "轮廓光布光（适配团体照、宠物合影、商业人像）",
            "发丝光布光（适配古风人像、婚纱摄影）",
            "人像摄影专业灯光布光（适配商业人像、专业写真）",
            "漫射光布光（适配美食、花卉特写，延伸人像柔光特写）"
        ],
        "梦幻奇幻/氛围风格": [
            "无",
            "体积光布光（适配森林光束人像、室内光轴场景）",
            "丁达尔光布光（适配咖啡馆烟雾人像、晨雾森林人像）",
            "自发光布光（适配奇幻人像、未来科技角色）"
        ],
        "风格化/潮流街头风格": [
            "无",
            "霓虹光布光（适配夜景街拍、潮流穿搭人像）",
            "舞台灯光布光（适配演唱会海报、舞台剧人像）"
        ]
    }
    
    @classmethod
    def INPUT_TYPES(s):
        """
        定义节点的输入参数
        
        返回:
            dict: 包含输入参数类型定义的字典
        """
        # 获取所有风格类型作为选项
        风格类型选项 = list(s.打光风格映射.keys())
        
        # 初始化每个风格的打光类型选项
        input_types = {
            "required": {
                "柔和清新_治愈风格": (["无"] + s.打光风格映射["柔和清新/治愈风格"][1:],),
                "戏剧张力_暗黑风格": (["无"] + s.打光风格映射["戏剧张力/暗黑风格"][1:],),
                "经典肖像_专业棚拍风": (["无"] + s.打光风格映射["经典肖像/专业棚拍风"][1:],),
                "梦幻奇幻_氛围风格": (["无"] + s.打光风格映射["梦幻奇幻/氛围风格"][1:],),
                "风格化_潮流街头风格": (["无"] + s.打光风格映射["风格化/潮流街头风格"][1:],),
            }
        }
        
        return input_types
    
    # 定义节点的输出类型
    RETURN_TYPES = ("STRING",)
    RETURN_NAMES = ("提示词",)
    
    # 节点的主要功能函数名称
    FUNCTION = "生成打光提示词"
    
    # 打光类型对应的详细提示词映射
    打光提示词映射 = {
        "亮调布光（适配日系写真、儿童摄影、治愈系人像）": "重新照明，高亮度低饱和，画面明快清新，光线均匀柔和，无硬阴影，温暖治愈氛围，马卡龙色调",
        "正面光布光（适配证件照、素背景人像）": "重新照明，光源正对主体，阴影极少，光线均匀通透，肤色真实自然，面部细节清晰，风格写实自然",
        "柔光布光（适配日常人像、婴儿摄影）": "重新照明，光线扩散均匀，无硬阴影（如阴天自然光），肌肤质感柔和，温暖柔和氛围，色彩过渡自然，风格亲切自然",
        "柔光箱光效布光（适配室内人像、棚拍、商业人像）": "重新照明，光线柔和且定向，照射均匀，阴影柔和自然，肤色真实还原，光线范围可控",
        "柔光过曝布光（适配日系清新人像、情绪片）": "重新照明，轻微过曝营造朦胧美感，逆光光斑效果，柔白或暖调光线，边缘模糊虚化，氛围温柔缱绻",
        "逆光布光（适配通透人像、日落场景）": "重新照明，光源从主体后方照射，形成明亮轮廓光晕，肌肤通透质感，可做剪影效果，暖金色或柔白色光线，梦幻氛围",
        "暗调布光（适配暗黑系人像、夜景科幻场景）": "重新照明，低亮度高反差，深暗色调，神秘悬疑氛围，光线聚焦人像主体，深色背景，边缘轮廓锐利，冷调肌肤质感",
        "聚光布光（适配情绪人像、人物特写）": "重新照明，光线集中于局部，明暗对比强烈，舞台感戏剧效果，突出人物情绪，光线边缘锐利，深色背景衬托主体",
        "顶光布光（适配反派特写、戏剧张力场景）": "重新照明，光源从主体正上方直射，眼袋与眼窝阴影明显，压迫感强烈氛围，面部下方偏暗、头顶/发丝明亮",
        "底光布光（适配恐怖题材、戏剧妆、创意人像）": "重新照明，光源从主体下方照射，诡异惊悚效果，面部轮廓扭曲，冷调或暗色调，视觉冲击强烈",
        "分割光布光（适配双面人格主题、时尚封面）": "重新照明，光线将画面一分为二，明暗对比强烈，面部半明半暗，视觉冲击强烈，风格化人物表达",
        "硬光过曝布光（适配工业风人像、街头摄影）": "重新照明，强光导致局部过曝，高反差对比，肌肤质感粗犷，阴影锐利分明，冷调或中性色调，人物率性张扬",
        "伦勃朗光布光（适配复古肖像、油画风创作）": "重新照明，45°侧光照射，面颊形成三角光区，暗部深邃亮部立体，经典肖像光效，复古油画质感",
        "轮廓光布光（适配团体照、宠物合影、商业人像）": "重新照明，光线沿主体边缘照射，主体与背景清晰分离，层次感增强，发丝与肩部轮廓明亮，光线强度柔和",
        "发丝光布光（适配古风人像、婚纱摄影）": "重新照明，光线针对性打在毛发边缘，发丝细腻有光泽，毛发根根分明，光线柔和不曝光，突出毛发质感",
        "人像摄影专业灯光布光（适配商业人像、专业写真）": "重新照明，三点布光（主光+辅光+轮廓光），面部层次均衡，主体与背景清晰分离，肤色均匀，阴影柔和，细节高清",
        "漫射光布光（适配美食、花卉特写，延伸人像柔光特写）": "重新照明，反射后均匀照射（如薄纱透光），光线柔和无硬影，突出细腻肌肤质感",
        "体积光布光（适配森林光束人像、室内光轴场景）": "重新照明，光线呈光束形态，空间感突出，空气中可见尘埃或雾气，光束穿透场景，梦幻有层次",
        "丁达尔光布光（适配咖啡馆烟雾人像、晨雾森林人像）": "重新照明，烟雾或雾气中形成光束（丁达尔效应），光线柔和朦胧，暖调或冷调可选，空灵梦幻氛围",
      "自发光布光（适配奇幻人像、未来科技角色）": "重新照明，主体自身向内发光，光线柔和或明亮，深色背景凸显光泽，科幻或奇幻风格，服饰 / 装备带发光细节",
            "霓虹光布光（适配夜景街拍、潮流穿搭人像）": "重新照明，彩色荧光效果，赛博朋克或复古港风，高饱和色彩（蓝、紫、粉为主），可带光轨，风格化强烈",
            "舞台灯光布光（适配演唱会海报、舞台剧人像）": "重新照明，多光源戏剧化效果，追光 + 染色灯组合，氛围热烈浓郁，主光明亮 + 辅光柔和，动态有张力"
        }
    
    def 生成打光提示词(self, 柔和清新_治愈风格, 戏剧张力_暗黑风格, 经典肖像_专业棚拍风, 梦幻奇幻_氛围风格, 风格化_潮流街头风格):
        """
        生成打光提示词的函数
        
        参数:
            柔和清新_治愈风格: 选择的柔和清新风格打光类型
            戏剧张力_暗黑风格: 选择的戏剧张力风格打光类型
            经典肖像_专业棚拍风: 选择的经典肖像风格打光类型
            梦幻奇幻_氛围风格: 选择的梦幻奇幻风格打光类型
            风格化_潮流街头风格: 选择的风格化潮流风格打光类型
        
        返回:
            tuple: 包含生成的提示词字符串的元组
        """
        # 初始化提示词列表
        提示词列表 = []
        
        # 处理柔和清新/治愈风格，如果不是"无"则获取对应的详细提示词
        if 柔和清新_治愈风格 != "无":
            # 查找对应的详细提示词，如果找不到则使用原始文本
            提示词 = self.打光提示词映射.get(柔和清新_治愈风格, 柔和清新_治愈风格)
            提示词列表.append(提示词)
        
        # 处理其他风格类别，如果不是"无"就添加到提示词列表
        if 戏剧张力_暗黑风格 != "无":
            # 查找对应的详细提示词，如果找不到则使用原始文本
            提示词 = self.打光提示词映射.get(戏剧张力_暗黑风格, 戏剧张力_暗黑风格)
            提示词列表.append(提示词)
        
        if 经典肖像_专业棚拍风 != "无":
            # 查找对应的详细提示词，如果找不到则使用原始文本
            提示词 = self.打光提示词映射.get(经典肖像_专业棚拍风, 经典肖像_专业棚拍风)
            提示词列表.append(提示词)
        
        if 梦幻奇幻_氛围风格 != "无":
            # 查找对应的详细提示词，如果找不到则使用原始文本
            提示词 = self.打光提示词映射.get(梦幻奇幻_氛围风格, 梦幻奇幻_氛围风格)
            提示词列表.append(提示词)
        
        if 风格化_潮流街头风格 != "无":
            # 查找对应的详细提示词，如果找不到则使用原始文本
            提示词 = self.打光提示词映射.get(风格化_潮流街头风格, 风格化_潮流街头风格)
            提示词列表.append(提示词)
        
        # 将所有提示词用逗号连接成一个字符串
        最终提示词 = ", ".join(提示词列表)
        
        # 返回生成的提示词
        return (最终提示词,)

# 定义节点映射，用于注册到ComfyUI
NODE_CLASS_MAPPINGS = {
    "🍥Qwen-打光预设": Qwen_打光预设
}

# 定义节点显示名称映射
NODE_DISPLAY_NAME_MAPPINGS = {
    "🍥Qwen-打光预设": "🍥Qwen-打光预设-xishen"
}
